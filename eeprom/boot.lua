local a,b,c=component,computer,unicode;local d,e;for f,g in a.list()do if g=="gpu"then d=a.proxy(f)end;if g=="screen"then e=f end end;if not d or not e then b.beep(1000,0.2)error("NO GPU")end;d.bind(e)local h,i=d.maxResolution()d.setResolution(h,i)local j,k=d.getResolution()local l={lvl="Info",safe="Disabled",wait="2",quick="Disabled",init="/bin/init.lua"}local m,n,o,p,q,r=0x0000AA,0xAA0000,0xFFFF00,0xFFFFFF,0xC0C0C0,0x000000;local function s(t,u)d.setBackground(t)d.setForeground(u)end;local function v(t)s(t,q)d.fill(1,1,j,k," ")end;local function w(x,g,u)if u then d.setForeground(u)end;d.set(math.floor((j-c.len(g))/2),x,g)end;local function y(z,x,A,B)local C=string.rep("=",A-2)d.set(z,x,"+"..C.."+")d.set(z,x+B-1,"+"..C.."+")for D=1,B-2 do d.set(z,x+D,"|")d.set(z+A-1,x+D,"|")end end;local function E(g)return b.pullSignal(g)end;local F={{l="Features",t="sub",i={{id="lvl",l="Log Level",o={"Debug","Info","Warn","Error"}},{id="safe",l="Safe Mode",o={"Enabled","Disabled"}}}},{l="Save & Exit",t="act",f=function()return true end},{l="Exit",t="act",f=function()b.shutdown(true)end}}local function G(H)local e,I=1,H.i;local A,B=math.floor(j*0.8),#I+4;local J,K=math.floor((j-A)/2),math.floor((k-B)/2)while true do s(m,q)d.fill(J,K,A,B," ")y(J,K,A,B)s(q,r)d.set(J+2,K," "..H.l.." ")for D,L in ipairs(I)do local x,M=K+1+D,l[L.id]if L.v then M=L.v end;if not M then M=""end;local N=A-4-c.len(L.l)-c.len(M)local O=" "..L.l..string.rep(" ",N)..M.." "if D==e then s(n,p)else s(m,q)end;d.set(J+2,x,O)end;local P,Q,R,S=E()if P=="key_down"then if S==1 or S==14 then return elseif S==200 and e>1 then e=e-1 elseif S==208 and e<#I then e=e+1 elseif S==28 then local L=I[e]if L.o then local T=1;for U,z in ipairs(L.o)do if z==l[L.id]then T=U end end;T=T+1;if T>#L.o then T=1 end;l[L.id]=L.o[T]elseif L.t=="inp"then s(n,p)local V,W=30,3;local X,Y=math.floor((j-V)/2),math.floor((k-W)/2)d.fill(X,Y,V,W," ")y(X,Y,V,W)local Z=""while true do d.set(X+2,Y+1,Z.."_  ")local _,Q,a0,a1=E()if _=="key_down"then if a1==28 then l[L.id]=Z;break elseif a1==14 then Z=c.sub(Z,1,-2)elseif a0>32 and a0<127 and c.len(Z)<V-4 then Z=Z..c.char(a0)end end end end end end end end;local function a2()local e,i=1,k-6;while true do v(m)s(q,r)d.fill(1,1,j,1," ")w(1,"AXIS BIOS SETUP")s(m,p)y(2,3,j-4,i)y(2,k-3,j-4,4)s(m,o)d.set(4,k-2,"Esc:Quit  ARROWS:Select  Enter:Open  F10:Save")for D,H in ipairs(F)do local z,x,A=4,3+D,j-8;local a3=H.l;if H.t=="sub"then a3="> "..a3 end;if D==e then s(n,p)a3=a3 ..string.rep(" ",A-c.len(a3))else s(m,o)end;d.set(z,x,a3)end;local P,Q,Q,S=E()if P=="key_down"then if S==200 then e=e-1;if e<1 then e=#F end elseif S==208 then e=e+1;if e>#F then e=1 end elseif S==1 then return elseif S==68 or S==28 then local H=F[e]if H.t=="sub"then G(H)elseif H.t=="act"then if H.f()then return end end end end end end;local a4={"    _        _      ___  ____  ","   / \\  __ _(_)___ / _ \\/ ___| ","  / _ \\ \\ \\/ / / __| | | \\___ \\ "," / ___ \\ >  <| \\__ \\ |_| |___) |","/_/   \\_/_/\\_\\_|___/\\___/|____/ "}local function a5()v(r)s(r,p)d.set(1,1,"AxisBIOS v0.4")d.set(1,2,"(C) 2025 Axis Corp")d.set(1,4,"Xen XKA")b.beep(1100,0.1)s(r,q)local a6=math.floor(k/3)for D,a7 in ipairs(a4)do w(a6+D,a7)end;s(r,p)w(k-2,"Press DEL to enter SETUP",q)local a8=tonumber(l.wait)or 2;if l.quick=="Enabled"then a8=0.1 end;local g=b.uptime()+a8;while b.uptime()<g do local e,Q,Q,S=b.pullSignal(0.1)if e=="key_down"and S==211 then return"S"end end end;if a5()=="S"then b.beep(1000,0.1)a2()a5()end;local a9;for f in a.list("filesystem")do if a.proxy(f).exists("/kernel.lua")then a9=f;break end end;if not a9 then v(r)d.set(1,1,"NO SYSTEM DISK")while true do b.pullSignal()end end;v(r)d.set(1,1,"booting")local N=a.proxy(a9)local aa=N.open("/kernel.lua","r")b.beep(900,0.2)local R=""while true do local a8=N.read(aa,math.huge)if not a8 then break end;R=R..a8 end;N.close(aa)if R:sub(1,3)=="\239\187\191"then R=R:sub(4)end;local ab={raw_component=a,raw_computer=b,boot_fs_address=a9,boot_args=l}setmetatable(ab,{__index=_G})local u,P=load(R,"=kernel","t",ab)if not u then error(P)end;u()